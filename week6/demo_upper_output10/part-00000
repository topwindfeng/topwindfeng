INFLUXDB HAS STRUGGLED A LONG TIME FOR THEIR STORAGE ENGINE (LEVELDB, ROCKSDB, BOLTDB) BEFORE THEY SETTLED WITH THEIR TIME STRUCTURED MERGE TREE (TSM TREE). IT CAN BE SEPARATE INTO TWO PARTS, INDEX FOR SERIES IDENTIFIERS AND STORE FOR DATA POINTS, WE ONLY FOCUS ON DATA POINTS.

TIME STRUCTURE MERGE TREE (TSM), IS A LITTLE BIT MISLEADING AS LOG STRUCTURED MERGE TREE (LSM). THE KEY CONCEPT FOR BOTH TSM AND LSM IS NOR LOG OR TREE OR TIME, IT'S MERGE. WHEN WRITE, DATA IS STORED IN MEMORY AND THEN FLUSHED TO DISK IN LARGE BATCH. WHEN READ, FIRST READ FROM MEMORY, THEN READ FROM DISK AND MERGE THE RESULT. WHEN DELETE, A TOMBSTONE IS ADDED, AND DATA WITH TOMBSTONE IS NOT RETURNED WHEN READ. IN BACKGROUND, SMALL CHUNKS ARE MERGED INTO BIG CHUNKS AND ITEMS MARKED AS DELETED ARE TRULY REMOVED TO SAVE DISK SPACE AND SPEED UP FUTURE QUERY, THIS BACKGROUND PROCEDURE IS CALLED COMPACTION. FOR TIME SERIES DATA, COMPACTION MAY INCREASE COMPRESSION RATIO A LOT FOR VERY REGULAR DATA.
THE DATA
A SIMPLIFIED VERSION OF TSM FILE IS ILLUSTRATED BELOW, EACH CHUNK CONTAINS THE SERIES IDENTIFIER, TIMESTAMPS AND VALUES. NOTE THAT TIMESTAMPS AND VALUES ARE STORED SEPARATELY INSTEAD OF INTERLEAVED, WHICH IS WHY INFLUXDB SAY THEY ARE USING COLUMN FORMAT. INFLUXDB USE ADAPTIVE COMPRESSION FOR DATA, IT WILL LOOP THROUGH THE DATA TO SEE IF IT CAN BE RUN LENGTH ENCODED, OTHERWISE FALLBACK TO GORILLAâ€™S OR VARIABLE LENGTH ENCODING. TIMESTAMPS AND VALUE USE DIFFERENT COMPRESSION CODEC BECAUSE TIMESTAMPS ARE NORMALLY VERY BIG INTEGERS (UNIX TIMESTAMP IN MILLISECOND OR NANOSECOND) WHILE VALUE ARE NORMALLY SMALL INTEGER OR FLOAT.

TRAINING
